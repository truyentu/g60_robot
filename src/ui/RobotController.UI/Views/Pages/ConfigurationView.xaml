<UserControl x:Class="RobotController.UI.Views.Pages.ConfigurationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:RobotController.UI.Views.Controls"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             Background="Transparent">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0" Text="CONFIGURATION" FontSize="18" FontWeight="Bold"
                   Foreground="#222222" Margin="0,0,0,16"/>

        <!-- Settings Tabs -->
        <TabControl Grid.Row="1" Background="Transparent" BorderThickness="0">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="Background" Value="#D8D8D8"/>
                    <Setter Property="Foreground" Value="#666666"/>
                    <Setter Property="Padding" Value="16,8"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="TabItem">
                                <Border x:Name="border" Background="{TemplateBinding Background}"
                                        CornerRadius="4,4,0,0" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter ContentSource="Header"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="#D8D8D8"/>
                                        <Setter Property="Foreground" Value="#222222"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </TabControl.Resources>

            <!-- Connection Settings -->
            <TabItem Header="Connection">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8" Padding="24">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="Core Connection" FontWeight="Bold" Foreground="#222222"
                                   FontSize="14" Margin="0,0,0,16"/>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Request Address:" Foreground="#666666" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding RepAddress}"
                                     Background="#FFFFFF" Foreground="#222222" Padding="8"/>
                        </Grid>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Subscribe Address:" Foreground="#666666" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding SubAddress}"
                                     Background="#FFFFFF" Foreground="#222222" Padding="8"/>
                        </Grid>

                        <CheckBox Content="Auto-connect on startup" Foreground="#222222"
                                  IsChecked="{Binding AutoConnect}" Margin="0,8,0,0"/>

                        <Separator Margin="0,24,0,24" Background="#999999"/>

                        <TextBlock Text="Serial Port (Firmware)" FontWeight="Bold" Foreground="#222222"
                                   FontSize="14" Margin="0,0,0,16"/>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="COM Port:" Foreground="#666666" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding AvailablePorts}"
                                      SelectedItem="{Binding SelectedPort}"
                                      Background="#FFFFFF"/>
                            <Button Grid.Column="2" Content="Refresh" Margin="8,0,0,0" Width="70"
                                    Command="{Binding RefreshPortsCommand}"/>
                        </Grid>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Baud Rate:" Foreground="#666666" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding BaudRates}"
                                      SelectedItem="{Binding SelectedBaudRate}"
                                      Background="#FFFFFF"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </TabItem>

            <!-- Robot Catalog -->
            <TabItem Header="Robot Catalog">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8" Padding="24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="380"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- Robot Catalog Panel -->
                        <controls:RobotCatalogPanel Grid.Column="0"
                                                    DataContext="{Binding DataContext.RobotCatalog, RelativeSource={RelativeSource AncestorType=Window}}"/>

                        <!-- Selected Robot Details -->
                        <Border Grid.Column="1" Background="#D0D0D0" CornerRadius="8" Margin="16,0,0,0" Padding="16">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <StackPanel>
                                    <TextBlock Text="SELECTED ROBOT DETAILS" FontSize="14" FontWeight="Bold"
                                               Foreground="#555555" Margin="0,0,0,16"/>

                                    <!-- Model Info -->
                                    <Border Background="#C8C8C8" CornerRadius="6" Padding="12" Margin="0,0,0,12">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="120"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Model ID:"
                                                       Foreground="#666666" Margin="0,4"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1"
                                                       Text="{Binding DataContext.RobotCatalog.ActiveModelId, RelativeSource={RelativeSource AncestorType=Window}}"
                                                       Foreground="#222222" Margin="0,4"/>

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Name:"
                                                       Foreground="#666666" Margin="0,4"/>
                                            <TextBlock Grid.Row="1" Grid.Column="1"
                                                       Text="{Binding DataContext.RobotCatalog.ActiveModelName, RelativeSource={RelativeSource AncestorType=Window}}"
                                                       Foreground="#222222" FontWeight="SemiBold" Margin="0,4"/>

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Instance ID:"
                                                       Foreground="#666666" Margin="0,4"/>
                                            <TextBlock Grid.Row="2" Grid.Column="1"
                                                       Text="{Binding DataContext.RobotCatalog.ActiveInstanceId, RelativeSource={RelativeSource AncestorType=Window}}"
                                                       Foreground="#222222" Margin="0,4"/>

                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="DOF:"
                                                       Foreground="#666666" Margin="0,4"/>
                                            <TextBlock Grid.Row="3" Grid.Column="1"
                                                       Text="{Binding DataContext.RobotCatalog.SelectedModel.Dof, RelativeSource={RelativeSource AncestorType=Window}, FallbackValue='-'}"
                                                       Foreground="#222222" Margin="0,4"/>

                                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Manufacturer:"
                                                       Foreground="#666666" Margin="0,4"/>
                                            <TextBlock Grid.Row="4" Grid.Column="1"
                                                       Text="{Binding DataContext.RobotCatalog.SelectedModel.Manufacturer, RelativeSource={RelativeSource AncestorType=Window}, FallbackValue='-'}"
                                                       Foreground="#222222" Margin="0,4"/>
                                        </Grid>
                                    </Border>

                                    <!-- Specifications -->
                                    <TextBlock Text="Specifications" Foreground="#666666" FontWeight="SemiBold"
                                               Margin="0,8,0,8"/>
                                    <Border Background="#C8C8C8" CornerRadius="6" Padding="12" Margin="0,0,0,12">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="Max Payload" Foreground="#666666" FontSize="11"/>
                                                <TextBlock Text="{Binding DataContext.RobotCatalog.SelectedModel.MaxPayloadKg, RelativeSource={RelativeSource AncestorType=Window}, StringFormat={}{0:F1} kg, FallbackValue='-'}"
                                                           Foreground="#222222" FontSize="18" FontWeight="Bold"/>
                                            </StackPanel>

                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="Reach" Foreground="#666666" FontSize="11"/>
                                                <TextBlock Text="{Binding DataContext.RobotCatalog.SelectedModel.ReachMm, RelativeSource={RelativeSource AncestorType=Window}, StringFormat={}{0:F0} mm, FallbackValue='-'}"
                                                           Foreground="#222222" FontSize="18" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Info -->
                                    <Border Background="#1a4a7a" CornerRadius="6" Padding="12" Margin="0,8,0,0">
                                        <StackPanel>
                                            <TextBlock Text="â„¹ Robot Selection" Foreground="#222222" FontWeight="SemiBold"/>
                                            <TextBlock TextWrapping="Wrap" Foreground="#333333" Margin="0,8,0,0"
                                                       Text="Click on a robot model in the catalog to select it. The Core will reload with the new robot's DH parameters and joint limits."/>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </ScrollViewer>
                        </Border>
                    </Grid>
                </Border>
            </TabItem>

            <!-- Homing -->
            <TabItem Header="Homing">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8">
                    <controls:HomingPanel DataContext="{Binding DataContext.Homing, RelativeSource={RelativeSource AncestorType=Window}}"/>
                </Border>
            </TabItem>

            <!-- Tools -->
            <TabItem Header="Tools">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8">
                    <controls:ToolPanel DataContext="{Binding DataContext.Tool, RelativeSource={RelativeSource AncestorType=Window}}"/>
                </Border>
            </TabItem>

            <!-- Base Frames -->
            <TabItem Header="Base Frames">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8">
                    <controls:BaseFramePanel DataContext="{Binding DataContext.BaseFrame, RelativeSource={RelativeSource AncestorType=Window}}"/>
                </Border>
            </TabItem>

            <!-- Robot Settings -->
            <TabItem Header="Robot">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8" Padding="24">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel MaxWidth="600" HorizontalAlignment="Left">
                            <TextBlock Text="Robot Information" FontWeight="Bold" Foreground="#222222"
                                       FontSize="14" Margin="0,0,0,16"/>

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Robot Name:" Foreground="#666666" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding RobotName}"
                                         Background="#FFFFFF" Foreground="#222222" Padding="8"/>
                            </Grid>

                            <Grid Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="150"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Model:" Foreground="#666666" VerticalAlignment="Center"/>
                                <TextBox Grid.Column="1" Text="{Binding RobotModel}"
                                         Background="#FFFFFF" Foreground="#222222" Padding="8" IsReadOnly="True"/>
                            </Grid>

                            <Separator Margin="0,16,0,16" Background="#999999"/>

                            <TextBlock Text="Joint Limits" FontWeight="Bold" Foreground="#222222"
                                       FontSize="14" Margin="0,0,0,16"/>

                            <ItemsControl ItemsSource="{Binding JointLimits}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="60"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="80"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding Name}"
                                                       Foreground="#222222" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="1" Text="Min:" Foreground="#666666"
                                                       HorizontalAlignment="Right" Margin="0,0,8,0"/>
                                            <TextBox Grid.Column="2" Text="{Binding MinLimit}"
                                                     Background="#FFFFFF" Foreground="#222222"
                                                     Padding="4" TextAlignment="Right"/>
                                            <TextBlock Grid.Column="3" Text="Max:" Foreground="#666666"
                                                       HorizontalAlignment="Right" Margin="0,0,8,0"/>
                                            <TextBox Grid.Column="4" Text="{Binding MaxLimit}"
                                                     Background="#FFFFFF" Foreground="#222222"
                                                     Padding="4" TextAlignment="Right"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Separator Margin="0,16,0,16" Background="#999999"/>

                            <TextBlock Text="TCP Offset" FontWeight="Bold" Foreground="#222222"
                                       FontSize="14" Margin="0,0,0,16"/>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0" Margin="0,0,8,0">
                                    <TextBlock Text="X (mm)" Foreground="#666666"/>
                                    <TextBox Text="{Binding TcpOffsetX}" Background="#FFFFFF"
                                             Foreground="#222222" Padding="8"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1" Margin="4,0">
                                    <TextBlock Text="Y (mm)" Foreground="#666666"/>
                                    <TextBox Text="{Binding TcpOffsetY}" Background="#FFFFFF"
                                             Foreground="#222222" Padding="8"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2" Margin="8,0,0,0">
                                    <TextBlock Text="Z (mm)" Foreground="#666666"/>
                                    <TextBox Text="{Binding TcpOffsetZ}" Background="#FFFFFF"
                                             Foreground="#222222" Padding="8"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>

            <!-- Safety Settings -->
            <TabItem Header="Safety">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8" Padding="24">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="Safety Settings" FontWeight="Bold" Foreground="#222222"
                                   FontSize="14" Margin="0,0,0,16"/>

                        <Border Background="#441111" CornerRadius="4" Padding="12" Margin="0,0,0,16">
                            <TextBlock Text="Warning: Changing safety settings may affect robot operation safety. Proceed with caution."
                                       Foreground="#FF8888" TextWrapping="Wrap"/>
                        </Border>

                        <CheckBox Content="Enable E-Stop Monitoring" Foreground="#222222"
                                  IsChecked="{Binding EStopEnabled}" Margin="0,0,0,8"/>

                        <CheckBox Content="Enable Soft Limits" Foreground="#222222"
                                  IsChecked="{Binding SoftLimitsEnabled}" Margin="0,0,0,8"/>

                        <CheckBox Content="Enable Velocity Monitoring" Foreground="#222222"
                                  IsChecked="{Binding VelocityMonitorEnabled}" Margin="0,0,0,16"/>

                        <Separator Margin="0,8,0,16" Background="#999999"/>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="T1 Mode Max Speed:" Foreground="#666666" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Value="{Binding T1MaxSpeed}"
                                    Minimum="50" Maximum="500" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="2" Text="{Binding T1MaxSpeed, StringFormat={}{0:F0} mm/s}"
                                       Foreground="#222222" VerticalAlignment="Center"/>
                        </Grid>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="60"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Auto Mode Max Speed:" Foreground="#666666" VerticalAlignment="Center"/>
                            <Slider Grid.Column="1" Value="{Binding AutoMaxSpeed}"
                                    Minimum="500" Maximum="3000" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="2" Text="{Binding AutoMaxSpeed, StringFormat={}{0:F0} mm/s}"
                                       Foreground="#222222" VerticalAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </TabItem>

            <!-- Welding Settings -->
            <TabItem Header="Welding">
                <Border Background="#D8D8D8" CornerRadius="0,8,8,8" Padding="24">
                    <StackPanel MaxWidth="500" HorizontalAlignment="Left">
                        <TextBlock Text="Welding Configuration" FontWeight="Bold" Foreground="#222222"
                                   FontSize="14" Margin="0,0,0,16"/>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Welder Type:" Foreground="#666666" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" SelectedItem="{Binding WelderType}" Background="#FFFFFF">
                                <ComboBoxItem Content="MIG/MAG"/>
                                <ComboBoxItem Content="TIG"/>
                                <ComboBoxItem Content="Spot"/>
                            </ComboBox>
                        </Grid>

                        <Grid Margin="0,0,0,12">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Wire Feed Unit:" Foreground="#666666" VerticalAlignment="Center"/>
                            <ComboBox Grid.Column="1" SelectedItem="{Binding WireFeeder}" Background="#FFFFFF">
                                <ComboBoxItem Content="Integrated"/>
                                <ComboBoxItem Content="External"/>
                            </ComboBox>
                        </Grid>

                        <CheckBox Content="Enable Arc Sensing" Foreground="#222222"
                                  IsChecked="{Binding ArcSensingEnabled}" Margin="0,8,0,8"/>

                        <CheckBox Content="Enable Seam Tracking" Foreground="#222222"
                                  IsChecked="{Binding SeamTrackingEnabled}" Margin="0,0,0,8"/>
                    </StackPanel>
                </Border>
            </TabItem>
        </TabControl>

        <!-- Save/Cancel Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Reset to Default" Width="120" Height="36" Margin="0,0,8,0"
                    Command="{Binding ResetDefaultCommand}"/>
            <Button Content="Apply" Width="100" Height="36" Margin="0,0,8,0"
                    Background="#0078D7" Foreground="#222222"
                    Command="{Binding ApplyCommand}"/>
            <Button Content="Save" Width="100" Height="36"
                    Background="#00AA00" Foreground="#222222"
                    Command="{Binding SaveCommand}"/>
        </StackPanel>
    </Grid>
</UserControl>
