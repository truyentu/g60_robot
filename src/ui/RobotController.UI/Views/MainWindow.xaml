<Window x:Class="RobotController.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:helix="http://helix-toolkit.org/wpf"
        xmlns:vm="clr-namespace:RobotController.UI.ViewModels"
        xmlns:controls="clr-namespace:RobotController.UI.Views.Controls"
        xmlns:pages="clr-namespace:RobotController.UI.Views.Pages"
        mc:Ignorable="d"
        Title="Robot Controller"
        Height="800" Width="1400"
        MinHeight="600" MinWidth="1000"
        Background="{StaticResource PrimaryBackground}"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Button Style -->
        <Style TargetType="Button" x:Key="ToolbarButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource ForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="Margin" Value="2"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3F3F46"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Foreground" Value="#666666"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- Menu -->
            <RowDefinition Height="Auto"/>  <!-- Toolbar -->
            <RowDefinition Height="*"/>     <!-- Content -->
            <RowDefinition Height="Auto"/>  <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{StaticResource SecondaryBackground}"
              Foreground="{StaticResource ForegroundBrush}">
            <MenuItem Header="_File">
                <MenuItem Header="_New Program" InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open Program" InputGestureText="Ctrl+O"/>
                <MenuItem Header="_Save Program" InputGestureText="Ctrl+S"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="MenuItem_Exit_Click" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Robot">
                <MenuItem Header="_Connect" Command="{Binding ConnectCommand}"/>
                <MenuItem Header="_Disconnect" Command="{Binding DisconnectCommand}"/>
                <Separator/>
                <MenuItem Header="_Home All Axes" IsEnabled="False"/>
                <MenuItem Header="_Enable Motors" IsEnabled="False"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Reset _Camera" Click="MenuItem_ResetCamera_Click"/>
                <MenuItem Header="_Top View" Click="MenuItem_TopView_Click"/>
                <MenuItem Header="_Front View" Click="MenuItem_FrontView_Click"/>
                <MenuItem Header="_Side View" Click="MenuItem_SideView_Click"/>
                <Separator/>
                <MenuItem Header="Show _Grid" IsCheckable="True" IsChecked="{Binding ShowGrid}"/>
                <MenuItem Header="Show _Axes" IsCheckable="True" IsChecked="{Binding ShowAxes}"/>
                <MenuItem Header="Show _TCP" IsCheckable="True" IsChecked="{Binding ShowTcp}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="MenuItem_About_Click"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{StaticResource SecondaryBackground}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal" Margin="5,3">
                <Button Content="Connect" Command="{Binding ConnectCommand}" Style="{StaticResource ToolbarButton}"/>
                <Button Content="Disconnect" Command="{Binding DisconnectCommand}" Style="{StaticResource ToolbarButton}"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <Button Content="Refresh" Command="{Binding RefreshStatusCommand}" Style="{StaticResource ToolbarButton}"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <Button Content="Home" Style="{StaticResource ToolbarButton}" IsEnabled="False"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <Button Content="Run" Style="{StaticResource ToolbarButton}" IsEnabled="False" Foreground="LimeGreen"/>
                <Button Content="Pause" Style="{StaticResource ToolbarButton}" IsEnabled="False" Foreground="Orange"/>
                <Button Content="Stop" Style="{StaticResource ToolbarButton}" IsEnabled="False" Foreground="Red"/>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" Margin="5,0"/>
                <TextBlock Text="Speed:" VerticalAlignment="Center" Foreground="Gray" Margin="5,0"/>
                <Slider Value="{Binding SpeedOverride}" Minimum="0" Maximum="100" Width="100"
                        VerticalAlignment="Center"/>
                <TextBlock Text="{Binding SpeedOverride, StringFormat={}{0:F0}%}" Width="35"
                           VerticalAlignment="Center" Foreground="{StaticResource ForegroundBrush}"/>
            </StackPanel>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" MinWidth="150"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="260" MinWidth="200"/>
            </Grid.ColumnDefinitions>

            <!-- Navigation Panel -->
            <Border Grid.Column="0" Background="{StaticResource SecondaryBackground}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Navigation" FontWeight="Bold" Margin="10"
                               Foreground="{StaticResource ForegroundBrush}"/>

                    <ListBox Grid.Row="1" Background="Transparent" BorderThickness="0"
                             Foreground="{StaticResource ForegroundBrush}"
                             SelectedIndex="{Binding SelectedNavIndex}">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="10,8"/>
                                <Style.Triggers>
                                    <Trigger Property="IsSelected" Value="True">
                                        <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </ListBox.ItemContainerStyle>
                        <ListBoxItem Content="Manual Jog"/>
                        <ListBoxItem Content="Program"/>
                        <ListBoxItem Content="I/O"/>
                        <ListBoxItem Content="Configuration"/>
                        <ListBoxItem Content="Diagnostics"/>
                        <ListBoxItem Content="Robot Catalog"/>
                        <ListBoxItem Content="URDF Import"/>
                    </ListBox>
                </Grid>
            </Border>

            <!-- Left Splitter -->
            <GridSplitter Grid.Column="1" Width="3" Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- 3D Viewport + Page Content -->
            <Grid Grid.Column="2">
                <!-- 3D Viewport (always visible in background) -->
                <Border Background="#1A1A1A">
                    <helix:HelixViewport3D x:Name="Viewport3D"
                                           Background="#1E1E1E"
                                           ShowCoordinateSystem="True"
                                           CoordinateSystemLabelForeground="White"
                                           ZoomExtentsWhenLoaded="True"
                                           CameraRotationMode="Turntable"
                                           IsRotationEnabled="True"
                                           IsPanEnabled="True"
                                           IsZoomEnabled="True"
                                           ShowViewCube="True"
                                           ViewCubeBackText="Back"
                                           ViewCubeFrontText="Front"
                                           ViewCubeLeftText="Left"
                                           ViewCubeRightText="Right"
                                           ViewCubeTopText="Top"
                                           ViewCubeBottomText="Bottom">

                        <!-- Camera -->
                        <helix:HelixViewport3D.Camera>
                            <PerspectiveCamera Position="1500,1500,1000"
                                               LookDirection="-1,-1,-0.5"
                                               UpDirection="0,0,1"
                                               FieldOfView="45"/>
                        </helix:HelixViewport3D.Camera>

                        <!-- Lighting -->
                        <ModelVisual3D x:Name="LightingModel">
                            <ModelVisual3D.Content>
                                <Model3DGroup>
                                    <AmbientLight Color="#404040"/>
                                    <DirectionalLight Color="#C8C8C8" Direction="-1,-1,-1"/>
                                    <DirectionalLight Color="#646464" Direction="1,0.5,0.5"/>
                                </Model3DGroup>
                            </ModelVisual3D.Content>
                        </ModelVisual3D>

                        <!-- Grid -->
                        <helix:GridLinesVisual3D x:Name="GridLines"
                                                 Width="2000" Length="2000"
                                                 MajorDistance="500" MinorDistance="100"
                                                 Thickness="1"
                                                 Fill="#404040"/>

                        <!-- Coordinate Axes -->
                        <helix:CoordinateSystemVisual3D x:Name="CoordAxes"
                                                        ArrowLengths="200"/>

                        <!-- Robot Model Container -->
                        <ModelVisual3D x:Name="RobotModelVisual"/>

                        <!-- TCP Marker Container -->
                        <ModelVisual3D x:Name="TcpMarkerVisual"/>

                    </helix:HelixViewport3D>
                </Border>

                <!-- Page Content Overlay -->
                <Border x:Name="PageContentOverlay" Background="#1E1E1E">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="1">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="2">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="3">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="4">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="5">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding SelectedNavIndex}" Value="6">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>

                    <Grid>
                        <!-- Program View (Index 1) -->
                        <pages:ProgramView DataContext="{Binding ProgramViewModel}">
                            <pages:ProgramView.Style>
                                <Style TargetType="pages:ProgramView">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="1">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:ProgramView.Style>
                        </pages:ProgramView>

                        <!-- I/O View (Index 2) -->
                        <pages:IOView DataContext="{Binding IoViewModel}">
                            <pages:IOView.Style>
                                <Style TargetType="pages:IOView">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="2">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:IOView.Style>
                        </pages:IOView>

                        <!-- Configuration View (Index 3) -->
                        <pages:ConfigurationView DataContext="{Binding ConfigurationViewModel}">
                            <pages:ConfigurationView.Style>
                                <Style TargetType="pages:ConfigurationView">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="3">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:ConfigurationView.Style>
                        </pages:ConfigurationView>

                        <!-- Diagnostics View (Index 4) -->
                        <pages:DiagnosticsView DataContext="{Binding DiagnosticsViewModel}">
                            <pages:DiagnosticsView.Style>
                                <Style TargetType="pages:DiagnosticsView">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="4">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:DiagnosticsView.Style>
                        </pages:DiagnosticsView>

                        <!-- Robot Catalog View (Index 5) -->
                        <pages:RobotPackageBrowser DataContext="{Binding RobotCatalogViewModel}">
                            <pages:RobotPackageBrowser.Style>
                                <Style TargetType="pages:RobotPackageBrowser">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="5">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:RobotPackageBrowser.Style>
                        </pages:RobotPackageBrowser>

                        <!-- URDF Import View (Index 6) -->
                        <pages:UrdfImportPage DataContext="{Binding UrdfImportViewModel}">
                            <pages:UrdfImportPage.Style>
                                <Style TargetType="pages:UrdfImportPage">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.SelectedNavIndex, RelativeSource={RelativeSource AncestorType=Window}}" Value="6">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </pages:UrdfImportPage.Style>
                        </pages:UrdfImportPage>
                    </Grid>
                </Border>
            </Grid>

            <!-- Right Splitter -->
            <GridSplitter Grid.Column="3" Width="3" Background="{StaticResource BorderBrush}"
                          HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- Properties Panel -->
            <Border Grid.Column="4" Background="{StaticResource SecondaryBackground}">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Visible"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="1">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="2">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="3">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="4">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="5">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding SelectedNavIndex}" Value="6">
                                <Setter Property="Visibility" Value="Collapsed"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <!-- Connection Status -->
                        <TextBlock Text="Connection" FontWeight="Bold" Margin="0,0,0,5"
                                   Foreground="{StaticResource ForegroundBrush}"/>
                        <Border Background="#333333" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <TextBlock Text="{Binding ConnectionStatus}"
                                               Foreground="{Binding ConnectionStatusColor}"
                                               FontWeight="Bold" FontSize="14"/>
                                    <TextBlock Text="{Binding CoreVersion, StringFormat=Core v{0}}"
                                               Foreground="Gray" FontSize="10"
                                               Visibility="{Binding IsConnected, Converter={StaticResource BoolToVisibility}}"/>
                                </StackPanel>
                                <Ellipse Grid.Column="1" Width="12" Height="12"
                                         Fill="{Binding ConnectionStatusColor}"
                                         VerticalAlignment="Center"/>
                            </Grid>
                        </Border>

                        <!-- Robot Status -->
                        <TextBlock Text="Robot Status" FontWeight="Bold" Margin="0,0,0,5"
                                   Foreground="{StaticResource ForegroundBrush}"/>
                        <Border Background="#333333" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <TextBlock Text="State" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding RobotState}" FontWeight="Bold"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="0" Grid.Column="1">
                                    <TextBlock Text="Mode" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding RobotMode}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,8,0,0">
                                    <TextBlock Text="Homed" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding IsHomed}"
                                               Foreground="{Binding IsHomed, Converter={StaticResource BoolToColor}}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,8,0,0">
                                    <TextBlock Text="Enabled" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding IsEnabled}"
                                               Foreground="{Binding IsEnabled, Converter={StaticResource BoolToColor}}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Position Display (KUKA-style with mode switch) -->
                        <controls:PositionDisplay DataContext="{Binding PositionDisplay}"
                                                  Margin="0,0,0,15"/>

                        <!-- Joint Positions -->
                        <TextBlock Text="Joint Positions" FontWeight="Bold" Margin="0,0,0,5"
                                   Foreground="{StaticResource ForegroundBrush}"/>
                        <Border Background="#333333" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                            <ItemsControl ItemsSource="{Binding JointPositions}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="35"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="70"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding Name}"
                                                       Foreground="Gray" FontWeight="Bold"/>
                                            <ProgressBar Grid.Column="1"
                                                         Value="{Binding Value}" Minimum="-180" Maximum="180"
                                                         Height="6" Margin="5,0"
                                                         Background="#222222" Foreground="{StaticResource AccentBrush}"/>
                                            <TextBlock Grid.Column="2" Text="{Binding Value, StringFormat={}{0:F2}째}"
                                                       Foreground="{StaticResource ForegroundBrush}"
                                                       HorizontalAlignment="Right"/>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Border>

                        <!-- TCP Position -->
                        <TextBlock Text="TCP Position" FontWeight="Bold" Margin="0,0,0,5"
                                   Foreground="{StaticResource ForegroundBrush}"/>
                        <Border Background="#333333" CornerRadius="3" Padding="10" Margin="0,0,0,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition/>
                                    <RowDefinition/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                    <ColumnDefinition/>
                                </Grid.ColumnDefinitions>

                                <!-- Position -->
                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,5,5">
                                    <TextBlock Text="X" Foreground="Red" FontSize="10" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding TcpX, StringFormat={}{0:F1}}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="0,0,5,5">
                                    <TextBlock Text="Y" Foreground="LimeGreen" FontSize="10" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding TcpY, StringFormat={}{0:F1}}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="0" Grid.Column="2" Margin="0,0,0,5">
                                    <TextBlock Text="Z" Foreground="DodgerBlue" FontSize="10" FontWeight="Bold"/>
                                    <TextBlock Text="{Binding TcpZ, StringFormat={}{0:F1}}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>

                                <!-- Orientation -->
                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,0,5,0">
                                    <TextBlock Text="Rx" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding TcpRx, StringFormat={}{0:F1}째}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,0,5,0">
                                    <TextBlock Text="Ry" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding TcpRy, StringFormat={}{0:F1}째}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="2">
                                    <TextBlock Text="Rz" Foreground="Gray" FontSize="10"/>
                                    <TextBlock Text="{Binding TcpRz, StringFormat={}{0:F1}째}"
                                               Foreground="{StaticResource ForegroundBrush}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Override Control (KUKA-inspired) -->
                        <controls:OverridePanel DataContext="{Binding Override}"
                                               Margin="0,0,0,15"/>

                        <!-- Manual Jog -->
                        <TextBlock Text="Motion Control" FontWeight="Bold" Margin="0,0,0,5"
                                   Foreground="{StaticResource ForegroundBrush}"/>
                        <controls:MotionControlPanel DataContext="{Binding MotionControl}"
                                                     Margin="0,0,0,10"/>

                        <controls:JogPanel DataContext="{Binding MotionControl}"
                                           Margin="0,0,0,15"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{StaticResource SecondaryBackground}"
                BorderBrush="{StaticResource BorderBrush}" BorderThickness="0,1,0,0">
            <Grid Margin="5,3">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Ellipse Width="10" Height="10" Fill="{Binding ConnectionStatusColor}" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding ConnectionStatus}" Foreground="{StaticResource ForegroundBrush}"/>
                </StackPanel>

                <TextBlock Grid.Column="1" Text="|" Foreground="Gray" Margin="10,0"/>

                <!-- Operation Mode Indicator -->
                <Border Grid.Column="2"
                        Background="{Binding Mode.ModeColor}"
                        CornerRadius="3"
                        Padding="8,2"
                        Margin="0,0,10,0">
                    <TextBlock Text="{Binding Mode.CurrentMode}"
                               FontWeight="SemiBold"
                               Foreground="Black"/>
                </Border>

                <TextBlock Grid.Column="3" Text="{Binding RobotState}" Foreground="{StaticResource ForegroundBrush}"/>

                <TextBlock Grid.Column="4" Text="Robot Controller v1.0.0" Foreground="Gray" HorizontalAlignment="Right"/>
            </Grid>
        </Border>

        <!-- E-STOP Button Overlay (always visible) -->
        <Button Grid.Row="2"
                Width="100" Height="100"
                HorizontalAlignment="Right" VerticalAlignment="Bottom"
                Margin="0,0,280,20"
                Command="{Binding TriggerEStopCommand}"
                Cursor="Hand">
            <Button.Template>
                <ControlTemplate TargetType="Button">
                    <Grid>
                        <!-- Shadow -->
                        <Ellipse Fill="#40000000" Margin="4,4,-4,-4"/>

                        <!-- Button Body -->
                        <Ellipse x:Name="ButtonBody" Fill="{Binding EStopButtonColor}">
                            <Ellipse.Effect>
                                <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="3"/>
                            </Ellipse.Effect>
                        </Ellipse>

                        <!-- Inner Ring -->
                        <Ellipse Stroke="#80000000" StrokeThickness="4" Margin="8"/>

                        <!-- Highlight -->
                        <Ellipse Margin="12">
                            <Ellipse.Fill>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                    <GradientStop Color="#40FFFFFF" Offset="0"/>
                                    <GradientStop Color="Transparent" Offset="0.5"/>
                                </LinearGradientBrush>
                            </Ellipse.Fill>
                        </Ellipse>

                        <!-- Text -->
                        <TextBlock Text="{Binding EStopButtonText}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   FontWeight="Bold" FontSize="11" Foreground="White"
                                   TextAlignment="Center" TextWrapping="Wrap" Width="70"/>
                    </Grid>

                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter TargetName="ButtonBody" Property="Fill" Value="#FF6666"/>
                        </Trigger>
                        <Trigger Property="IsPressed" Value="True">
                            <Setter TargetName="ButtonBody" Property="Fill" Value="#CC0000"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Button.Template>
        </Button>

        <!-- E-STOP Reset Confirmation Dialog -->
        <Border Grid.Row="0" Grid.RowSpan="4"
                Background="#80000000"
                Visibility="{Binding ShowEStopConfirmDialog, Converter={StaticResource BoolToVisibility}}">
            <Border Background="#2D2D2D" CornerRadius="8"
                    Width="350" Height="180"
                    HorizontalAlignment="Center" VerticalAlignment="Center">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="Reset E-STOP?"
                               FontSize="18" FontWeight="Bold"
                               Foreground="White" Margin="0,0,0,10"/>

                    <TextBlock Grid.Row="1" TextWrapping="Wrap" Foreground="#AAAAAA">
                        <Run Text="E-STOP is currently active. "/>
                        <Run Text="Please verify all hazards are clear before resetting." Foreground="#FFAA00"/>
                    </TextBlock>

                    <StackPanel Grid.Row="2" Orientation="Horizontal"
                                HorizontalAlignment="Right" Margin="0,15,0,0">
                        <Button Content="Cancel" Width="80" Height="32" Margin="0,0,10,0"
                                Command="{Binding CancelEStopResetCommand}"/>
                        <Button Content="Reset E-STOP" Width="100" Height="32"
                                Background="#008800" Foreground="White"
                                Command="{Binding ResetEStopCommand}"/>
                    </StackPanel>
                </Grid>
            </Border>
        </Border>
    </Grid>
</Window>
